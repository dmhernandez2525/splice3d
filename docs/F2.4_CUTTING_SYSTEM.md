# F2.4 Cutting System

## Overview

Phase F2.4 implements the filament cutting subsystem with a multi-phase cut sequence, blade wear tracking, force monitoring, maintenance alerts, and EEPROM-persistent statistics.

## Cut Sequence

1. **RETRACTING** - Pull filament back slightly for cleaner cut ends
2. **CLOSING** - Servo moves to closed angle (blade engages)
3. **HOLDING** - Brief hold for complete cut, force reading taken
4. **OPENING** - Servo returns to open angle
5. **VERIFYING** - Small advance to confirm filament separation
6. **DONE** - Result evaluated, statistics updated

## Blade Wear Detection

Servo force is estimated via analog reading during the HOLDING phase. If the reading exceeds the configured threshold (`max_force_threshold`), the cut is flagged as `BLADE_WORN`, indicating the blade needs replacement.

## Maintenance Alerts

After the configured number of cuts (`maintenance_interval_cuts`, default 500), the firmware outputs a `CUTTER_MAINT` warning. Use `CUTTER MAINT_ACK` to reset the counter after blade replacement.

## EEPROM Persistence

Cut statistics (total, success, fail, last maintenance) are stored in EEPROM at address 64 with a checksum for integrity verification. Statistics persist across power cycles.

## Serial Commands

| Command | Description |
|---------|-------------|
| `CUTTER` | Query cutter status and statistics |
| `CUTTER CUT` | Queue a manual single cut |
| `CUTTER ANGLES <open> <closed>` | Set servo angles |
| `CUTTER TRAVEL <ms>` | Set servo travel time |
| `CUTTER MAINT_ACK` | Acknowledge maintenance alert |
| `CUTTER MAINT_INTERVAL <n>` | Set maintenance interval |
| `CUTTER SAVE` | Persist statistics to EEPROM |
| `CUTTER RESET` | Reset all cut statistics |

## Validation

```bash
python3 scripts/hardware/validate_f2_4.py
python3 -m pytest postprocessor/tests/test_cutting_system_validation.py -v
```

## Files

| File | Description |
|------|-------------|
| `firmware/src/cutting_system.h` | API declarations |
| `firmware/src/cutting_system.cpp` | Cut sequence, wear tracking, EEPROM |
| `firmware/src/serial_cutting.cpp` | CUTTER serial subcommand handler |
| `hardware/f2_4/spec/cutting_system_validation.json` | Acceptance spec |
