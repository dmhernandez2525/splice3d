# F4.1 Telemetry Stream

## Overview

The telemetry stream module provides periodic JSON-formatted status
output for host integration. Supports summary and verbose modes with
configurable intervals, heartbeat keep-alive, and one-shot reports.

## Stream Modes

| Mode | Description | Data |
|------|-------------|------|
| OFF | No streaming | None |
| SUMMARY | Compact status | Core fields only |
| VERBOSE | Full telemetry | All subsystems |

## Summary Output

```json
{
  "type": "telemetry",
  "t": 12345,
  "state": "IDLE",
  "temp": 210.5,
  "target": 210.0,
  "pos_mm": 150.25,
  "vel": 12.5,
  "slip": false,
  "splice_active": false,
  "quality": 0.95,
  "error": false
}
```

## Verbose Output

Includes nested sections for temperature, encoder, motors, splice
state, position tracking, and recovery status.

## Heartbeat

When enabled, emits a heartbeat JSON message every 5 seconds:

```json
{"type": "heartbeat", "t": 12345, "seq": 42}
```

Hosts can use heartbeat messages to detect firmware disconnection.

## Serial Commands

```
STREAM                 Show current config
STREAM OFF             Disable streaming
STREAM SUMMARY         Enable summary mode
STREAM VERBOSE         Enable verbose mode
STREAM INTERVAL <ms>   Set interval (min 100ms)
STREAM HEARTBEAT       Enable heartbeat
STREAM HEARTBEAT OFF   Disable heartbeat
STREAM REPORT          Emit one-shot verbose report
```

## Configuration

| Parameter | Default | Min |
|-----------|---------|-----|
| Stream interval | 1000 ms | 100 ms |
| Heartbeat interval | 5000 ms | fixed |

## Validation

```bash
python3 scripts/hardware/validate_f4_1.py
python3 -m unittest postprocessor.tests.test_telemetry_stream_validation -v
```
